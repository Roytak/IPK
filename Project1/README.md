# Documentation of Project 1 Implementation for IPK 2022/2023

Name and surname: Roman Janota

Login: xjanot04

## Program structure
The program begins by parsing the command-line arguments. Available arguments are:
- `--help` or `-H`, prints the usage message and terminates the program,
- `--host <host>` or `-h <host>`, where \<host\> is the *IPv4* of the server,
- `--port <port>` or `-p <port>`, where \<port\> is the port on which the server listens for new connections,
- `--mode <mode>` or `-m <mode>`, where \<mode\> is the internet protocol to be used, can be either TCP or UDP.

The last three arguments are mandatory.

### Client initialization

Once the command-line arguments are parsed, the obtained values are used to create a client socket and a to the server connection, if the selected mode is TCP. The socket is blocking. In this phase a `struct sockaddr_in` structure is also created, which will later be used for the communication.

### Communication

Sending messages and receiving responses is done in a loop in the main function for both TCP and UDP protocols. Both protocols use the C standard functions `sendto` and `recvfrom` for sending and receiving messages, respectively. The messages sent to the server are read line by line from the standard input.
When sending a message the only difference between TCP and UDP is that based on the *IPK Calculator Protocol*[1], there are two extra bytes that need to be sent for the UDP variant. Also the payload that is being set has to be prepared differently. This is done by the function *str_to_bin*. The maximum length of a UDP payload is 255 bytes.
Receiving a message works similarly in a sense. If the protocol used is TCP, the response is just printed to the standard output, otherwise a function *bin_to_str* converts the response to a readable format and prints it.
If at any point the program receives an interrupt signal, the main loop is exited. If the protocol used is TCP a *BYE* message is sent to the server and the client waits for a response. The socket is then closed and program terminated.

## Tests

The project contains it's own set of tests. The tests can be found in the `tests` subdirectory and they are designed for checking the programs functionality after code changes. The tests simply execute a shell scripts, which get generated by *CMake*. These scripts first start a server in the background, then run the client with it's input. Call `diff` the with client's output and expected output and lastly kill the server process.
To be able to run the tests, *bash* and the *ipkpd* binaries have to be installed. The tests can be run in the `build` directory like this: `make test`. The program was tested on a *NixOS* virtual machine.

## Requirements

- C compiler,
- CMake (>= 2.8.12),
- \*nix like system, checked by CMake.

## Bibliography
[1] - The IPK Calculator Protocol https://git.fit.vutbr.cz/NESFIT/IPK-Projekty/src/branch/master/Project%201

Linux C socket programming examples - https://git.fit.vutbr.cz/NESFIT/IPK-Projekty/src/branch/master/Stubs/cpp
